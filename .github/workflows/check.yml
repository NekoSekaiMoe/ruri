name: Build check

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
    paths:
      - 'src/**'
      - 'build/**'
      - 'test/**'
      - 'configure'
      - 'Makefile.in'
      - '.github/workflows/test.yml'
  pull_request:

jobs:
  test:
    name: checksuite
    strategy:
      matrix:
        include:
        - args: --disable-libcap --disable-libseccomp --disable-rurienv --enable-static --enable-debug
        - args: --disable-libcap --disable-libseccomp --disable-rurienv --enable-static
        - args: --disable-libcap --disable-libseccomp --disable-rurienv
        - args: --disable-libcap --disable-libseccomp
        - args: --enable-static
        - args: --enable-debug
        - args: --enable-static --enable-debug
        - args: --enable-static --disable-rurienv
        - args: --enable-static --enable-debug --disable-rurienv
        - args: --disable-rurienv
        - os: ubuntu-latest
        - os: ubuntu-22.04-arm64
        - os: ubuntu-22.04
    runs-on: ${{ matrix.os }}
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      - name: Install dep
        run: |
          sudo apt update && sudo apt install -y git wget
          sudo apt install --no-install-recommends -y \
          make \
          liblibseccomp-dev \
          liblibcap-dev \
          libc6-dev \
          binutils gdb gcc
      - name: Configure
        run: ./configure -C ${{ matrix.args }}
      - name: Build
        run: |
          make -j8
      - name: Show version
        run: ./ruri -v


